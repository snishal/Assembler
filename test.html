<!DOCTYPE html>
<html>
<head>
	<title>Assembler</title>
	<style type="text/css">
		*{
			box-sizing: border-box;
		}
		#code{
			float: left;
			width: 25%;
			margin-left: 5%;
			height: 500px;
			overflow: auto;
		}
		#lineNumber{
			float: left;
			background: mediumblue;
			color: white;
			padding: 30px;
		}
		#source{
			background: lightgrey;
			padding: 30px;
			text-align: center;
		}
		#assembler{
			float: left;
			width: 60%;
			margin-left: 5%;
		}
		#svg{
			height: 300px;
			overflow: auto;
		}
		.btn{
			cursor: pointer;
			padding: 10px 30px;
			border: none;
			background-color: #33adff;
			color: white;
			margin-top: 5%;
			margin-left: 7%;
		}
		.btn:hover{
			box-shadow: 5px 10px #888888;
		}
		.active{
			stroke: red !important;	
		}
	</style>
</head>
<body onload="loadCode()">
	<center><h1>Visualize Assembler</h1></center>
	<div id="main">
		<div id="code">
		</div>
		<div id="assembler">
			<div id="svg">
				<embed src="partial.svg"/>
			</div>
			<div>
				<h2>Symbol Table</h2>
				<table id="symbolTable">
					<th>
						<td>Name</td>
						<td>Type</td>
						<td>Size</td>
						<td>Location</td>
					</th>
				</table>
			</div>
		</div>
		<div>
			<button class="btn" onclick="prev()">Prev</button>
			<button class="btn" onclick="next()">Next</button>
			<button class="btn">Last</button>
		</div>
	</div>
</body>
<script type="text/javascript">
	function loadCode(){
		var code = sessionStorage.getItem('code');
		if(code){
			document.getElementById('code').innerHTML = code;
		}else{
			document.location.href = '/';
		}
	}

	var lineNum = 1;
	var symbolTable = [];
	
	function prev(){
		if(lineNum > 1){
			line = document.getElementById(lineNum);
			line.innerHTML = line.innerHTML.replace("⇒ ", "");
			lineNum--;
			line = document.getElementById(lineNum);
			line.innerHTML = "⇒ " + line.innerHTML;
			var code = document.getElementById('code');
			code.scroll(0, line.offsetTop - document.getElementById(1).offsetTop);
		}
	}

	function next(){
		var nextLine = document.getElementById(lineNum+1);
		if(nextLine){
			line = document.getElementById(lineNum);
			line.innerHTML = line.innerHTML.replace("⇒ ", "");
			lineNum++;
			nextLine.innerHTML = "⇒ " + nextLine.innerHTML;
			var code = document.getElementById('code');
			code.scroll(0, nextLine.offsetTop - document.getElementById(1).offsetTop);
		}
	}

	function parseInstruction(instruction){
		var arr = instruction.split(" ");
		var parsedInstruction = {
			label: '',
			opcode: ''
		};
		if(arr[0].includes(':')){
			parsedInstruction.label = arr[0].replace(':', '');
			parsedInstruction.opcode = arr[1];
		}else{
			parsedInstruction.opcode = arr[0];
		}

		return parsedInstruction;
	}

	function findLabel(label, symbolTable){
		for(var i = 0; i < symbolTable.length; i++){
			if(label == symbolTable[i].name)return true;
		}
		return false;
	}

	function pass1(source){
		let lc = 0,
			parsedInstruction;
		for(var i = 0; i < source.length; i++){
			parsedInstruction = parseInstruction(source[i]);
			if(parsedInstruction.label != ''){
				if(findLabel(parsedInstruction.label, symbolTable)){
					return false
				}else{
					symbolTable.push({
						name: parsedInstruction.label,
						type: 'label',
						size: 0,
						Location:lc
					})
				}
			}
		}
	}
</script>
</html>